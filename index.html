<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>Simple Chat</title>
		<link type="text/css" href="css/ui-lightness/jquery-ui-1.8.2.custom.css" rel="stylesheet" />	
	<script type="text/javascript" src="js/jquery-1.4.2.min.js"></script>
  <script type="text/javascript" src="js/jquery-ui-1.8.2.custom.min.js"></script>
  <script type="text/javascript" src="js/jquery.scrollTo-min.js"></script>

 	<script src="amqp-js/javascripts/mq.js" type="text/javascript"></script>
	<script src="amqp-js/javascripts/swfobject.js" type="text/javascript"></script>
	
			<style type="text/css">
			/*demo page css*/
			body{ font: 62.5% "Trebuchet MS", sans-serif; margin: 50px;}
			.demoHeaders { margin-top: 2em; }
			#dialog_link {padding: .4em 1em .4em 20px;text-decoration: none;position: relative;}
			#dialog_link span.ui-icon {margin: 0 5px 0 0;position: absolute;left: .2em;top: 50%;margin-top: -8px;}
			ul#icons {margin: 0; padding: 0;}
			ul#icons li {margin: 2px; position: relative; padding: 4px 0; cursor: pointer; float: left;  list-style: none;}
			ul#icons span.ui-icon {float: left; margin: 0 4px;}
			#message { width: 40%; margin-top: 30px; margin-right: 30px;}
			#messages{
			  width: 70%; height: 250pt; border: 1px solid rgb(85, 85, 85);
		    font: 12pt "Trebuchet MS", sans-serif; overflow:auto;
			  }
		</style>	

	
</head>

<body>
  <h1>Simple Chat</h1>
  <div id="messages">
  </div>
  <form id="target_messanger">
    <input name="message" type="text" id="message" />
    <input type="submit" value="Add Message" />
  </form>
	<script type="text/javascript">
  	var message_id = 0;
	  $(function(){
	    
	    MQ.configure({ host: "109.74.202.172" });
	  	MQ.on("load", function() { console.log("Test");	});
		  MQ.on("connect", function() {	
		    $("#messages").append( 
	    	  "<p style='margin:0px;'>" +
	    	  "  Connected !!! " +
	    	  "</p>"
	    	);
		  });
	    MQ.on("disconnect", function() {		
		    $("#messages").append( 
	    	  "<p style='margin:0px;'>" +
	    	  "  Disconnected !!! " +
	    	  "</p>"
	    	);
	    });
	
	    MQ.queue("auto").callback(function(m) {		alert("No Binding Matches");	});
	
	    MQ.queue("auto").bind("simple_chat", "simple_chat").callback(function(m){
	    	$("#messages").append( 
	    	  "<p style='margin:0px;' id='message_" + message_id + "''>" +
	    	  " > " + m.data.value +
	    	  "</p>"
	    	);
	    	$("div#messages").scrollTo("max");
      	$("#message_" + message_id).effect("highlight", {}, 1000);
	    	message_id ++;
	    });
	
	
	swfobject.embedSWF(
		"amqp-js/swfs/amqp.swf?" + Math.random().toString(),
		"AMQPProxy",
		"1", "1", "9", "amqp-js/swfs/expressInstall.swf",
		{},
		{ allowScriptAccess: "always", wmode: "opaque", bgcolor: "#ff0000" },
		{},
		function(){}
	);
	
	$('#target_messanger').submit(function() {
	  if( $("#message").val() != "" ){
   	  MQ.exchange("simple_chat").publish({ value: $("#message").val() }, "simple_chat");
   	  $("#message").val("");
	  }
    return false;
  });
	
 	});
	</script>
	
  <div id="amqp-wrap" style="position:absolute;z-index:10000;">
	  <div id="AMQPProxy">Loading AMQP Proxy</div>
  </div>

</body>
</html>
